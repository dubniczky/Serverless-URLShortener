<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Private URL shortener</title>
        <script type="text/javascript">

        $(document).ready(function() {

            // used only to allow local serving of files
            $.ajaxSetup({
                beforeSend: function(xhr) {
                    if (xhr.overrideMimeType) {
                        xhr.overrideMimeType("application/json");
                    }
                }
            });

            $('#url_input').focus();    // set initial focus

            $('form#submit').submit(function(event) {
                $('#url_input_submit').prop('disabled', true);

                // process the form
                $.ajax({
                    type        : 'POST',
                    url         : '/create',
                    data        : JSON.stringify({ 'long_url' : $('#url_input').val(), 'cdn_prefix': window.location.hostname }),
                    contentType : 'application/json; charset=utf-8',
                    dataType    : 'json',
                    encode      : true
                })
                .done(function(data,textStatus, jqXHR) {
                    $('#url_input_submit').prop('disabled', false);
                    if (data.error) {
                        $('#url-group').addClass('has-error'); // add the error class to show red input
                        $('#url-error').show().text(data.error); // add the actual error message under our input
                    } else {
                        $('form#submit').hide();        // hide initial submit form
                        $('form#result').show();        // and show the one used to display the results
                        $('#long_url').text(data.long_url);
                        $('#short_id').val(data.short_id).focus().select();
                    }
                })
                .fail(function(_, _, errorThrown) {
                    $('#url_input_submit').prop('disabled', false);
                    $('#url-group').addClass('has-error'); // add the error class to show red input
                    $('#url-error').show().text("Server error: "+errorThrown); // add the actual error message under our input
                });

                // stop the form from submitting the normal way and refreshing the page
                event.preventDefault();
            });
        
            $('form#result').submit(function(event) {
                location.reload();
            });

        });
        </script>
        <style>
            .wrapper {
                margin: 10px;
                width: calc(100vw - 20px);
                height: calc(100vh - 20px);
                background-color: #f5f5f5;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .center-box {
                width: 600px;
                height: 300px;

                background-color: #f5f5f5;
                border: 1px solid #ccc;
                border-radius: 4px;
            }
            textarea {
                width: calc(100% - 20px);
                margin-left: 10px;
                margin-top: 10px;
                height: 100px;
            }
            h2 {
                text-align: center;
                margin: 0;
                font-weight: lighter;
                font-style: sans-serif;
            }
            button {
                width: calc(100% - 20px);
                margin-left: 10px;
                margin-top: 10px;
                height: 35px;
                border-style: none;
                background-color: #94a89d;
                cursor: pointer;
            }
            button:hover {
                filter: brightness(1.1);
            }
        </style>
    </head>
    <body>
        <div class="wrapper">
            <div class="center-box">
                <h2>Paste URL to shorten</h2>
                <textarea id="url-textarea"></textarea>
                <input type="number">
                <button>Shorten</button>
            </div>
        </div>
    </body>
</html>